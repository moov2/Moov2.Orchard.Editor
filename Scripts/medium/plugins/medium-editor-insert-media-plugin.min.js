!function(e,t,i,a){"use strict";function o(i,a){this.el=i,this.$el=e(i),this.templates=t.MediumInsert.Templates,this.core=this.$el.data("plugin_"+r),this.options=e.extend(!0,{},s,a),this._defaults=s,this._name=r,this.core.getEditor()&&(this.core.getEditor()._serializePreImages=this.core.getEditor().serialize,this.core.getEditor().serialize=this.editorSerialize),this.init()}var r="mediumInsert",n="OrchardMedia",s={label:'<span class="fa fa-camera"></span>',captions:!0,captionPlaceholder:"Type caption for image (optional)"};o.prototype.add=function(){var t,i=location.href.toLowerCase().indexOf("/admin/"),a=this;-1!==i&&(t=location.href.substr(0,i)+"/Admin/Orchard.MediaLibrary?dialog=true",e.colorbox({href:t,iframe:!0,reposition:!0,width:"90%",height:"90%",onLoad:function(){e("html, body").css("overflow","hidden")},onClosed:function(){var t=e.colorbox.selectedData;t&&0!==t.length&&(a.addMedia(t),e("html, body").css("overflow",""))}}))},o.prototype.addImage=function(t,i){var a=this.$el.find(".medium-insert-active");if(a.is("p"))a.replaceWith('<figure class="medium-insert-active">'+a.html()+"</figure>"),a=this.$el.find(".medium-insert-active"),a.next().is("p")?this.core.moveCaret(a.next()):(a.after("<p><br></p>"),this.core.moveCaret(a.next()));else{var o=e('<figure class="medium-insert-active"></figure>');a.after(o),a=o}a.find("br").remove(),a.append('\n	<img src="'+t.resource+'" alt="'+(t.alternateText||"")+'" />\n'),t.caption&&a.append('	<figcaption contenteditable="true">'+t.caption+"</figcaption>\n"),this.core.triggerInput(),i&&(this.core.hideButtons(),a.find("img").click())},o.prototype.addMedia=function(e){for(var t=0;t<e.length;t++)switch(e[t].contentType){case"Image":this.addImage(e[t],t+1===e.length);break;default:continue}},o.prototype.editorSerialize=function(){var t=this._serializePreImages();return e.each(t,function(i){var a=e("<div />").html(t[i].value);a.find("figcaption, figure").removeAttr("contenteditable"),a.find("figure").removeClass("medium-insert-image"),a.find("figcaption").removeAttr("data-placeholder").removeClass("medium-insert-caption-placeholder"),a.find('*[class=""]').removeAttr("class"),t[i].value=a.html()}),t},o.prototype.events=function(){e(i).on("click",e.proxy(this,"unselectImage")),this.$el.on("click","figure img",e.proxy(this,"selectImage"))},o.prototype.getCore=function(){return this.core},o.prototype.init=function(){var e=this.$el.find("figure");e.attr("contenteditable",!1),e.find("figcaption").attr("contenteditable",!0),this.events()},o.prototype.selectImage=function(t){var i,a=this;this.core.options.enabled&&(t.stopPropagation(),i=e(t.target),this.$currentImage=i,this.$el.blur(),i.addClass("medium-insert-image-active"),i.closest(".medium-insert-images").addClass("medium-insert-active"),setTimeout(function(){a.options.captions&&a.core.addCaption(i.closest("figure"),a.options.captionPlaceholder)},50))},o.prototype.unselectImage=function(t){var i=e(t.target),a=this.$el.find(".medium-insert-image-active");return i.is("img")&&i.hasClass("medium-insert-image-active")?(a.not(i).removeClass("medium-insert-image-active"),void this.core.removeCaptions(i)):(a.removeClass("medium-insert-image-active"),i.is(".medium-insert-caption-placeholder")?this.core.removeCaptionPlaceholder(a.closest("figure")):i.is("figcaption")===!1&&this.core.removeCaptions(),void(this.$currentImage=null))},e.fn[r+n]=function(t){return this.each(function(){e.data(this,"plugin_"+r+n)||e.data(this,"plugin_"+r+n,new o(this,t))})}}(jQuery,window,document);