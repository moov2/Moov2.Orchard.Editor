/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

window.Editor = window.Editor || {
    plugins: [],
    instances: []
};
window.Editor.plugins.push({
    action: 'ace',
    init: true,
    exec: function (instance) {
        var editor, session, $input;

        /**
         * Add provided media to editor, dictated by current ace editor selection state.
         */
        var addMedia = function (e) {
            if (!e || !e.detail || !e.detail.mediaItems) {
                return;
            }

            for (var i = 0; i < e.detail.mediaItems.length; i++) {

                if (e.detail.mediaItems[i].contentType.toLowerCase() === 'document') {
                    insertDocument(e.detail.mediaItems[i]);
                    continue;
                }

                if (e.detail.mediaItems[i].contentType.toLowerCase() === 'image' || e.detail.mediaItems[i].contentType.toLowerCase() === 'vectorimage') {
                    insertImage(e.detail.mediaItems[i]);
                    continue;
                }
            }
        };

        /**
         * Filters out unwanted annotations (e.g. warning about doctype) due to common
         * case is the HTML being edited is not a full HTML document but a piece of HTML.
         */
        var filterAnnotation = function () {
            var annotations = session.getAnnotations() || [], i = len = annotations.length;

            while (i--) {
                if (/doctype first\. Expected/.test(annotations[i].text)) {
                    annotations.splice(i, 1);
                }
            }

            if (len > annotations.length) {
                session.setAnnotations(annotations);
            }
        };

        /**
         * Returns textarea that needs to get turned into Ace editor.
         */
        var getTextArea = function () {
            return instance.$el.querySelector('.js-editor-code > textarea');
        };

        /**
         * Initialises Ace editor.
         */
        var init = function () {
            editor = ace.edit(getTextArea().id);
            session = editor.getSession();

            $input = instance.$el.querySelector('.editor-input');

            editor.setTheme('ace/theme/monokai');
            editor.setShowPrintMargin(false);
            editor.$blockScrolling = Infinity;

            session.setMode('ace/mode/html');
            session.setUseWrapMode(true);

            session.on('changeAnnotation', filterAnnotation);
            session.on('change', update);

            $input.addEventListener('change', updateSession);
            instance.$el.addEventListener('editor:valueUpdate', updateSession);
            instance.$el.addEventListener('editor:addMedia', addMedia);
            instance.$el.addEventListener('editor:insertHtml', insertHTML);
        };

        /**
         * Inserts hyperlink for document.
         */
        var insertDocument = function(asset) {
            var cursorPosition = editor.selection.getRange().start,
                line = editor.session.getLine(cursorPosition.row);

            // inserting media URL between two quotes
            if (line.substr(cursorPosition.column - 5, 5).toLowerCase() === 'href="') {
                editor.insert(asset.resource);
                return;
            }

            // inserting media URL with quotes
            if (line.substr(cursorPosition.column - 4, 4).toLowerCase() === 'href=') {
                editor.insert('"' + asset.resource + '"');
                return;
            }

            // ensure that the current cursor position warrants a complete anchor HTML
            // tag instead of the URL.
            var character = line.substr(cursorPosition.column - 1, 1).toLowerCase()

            if (character === '>' || character === '' || character === ' ') {
                editor.insert('<a href="' + asset.resource + '" title="' + asset.alternateText + '" class="" />\n');
                return;
            }

            editor.insert(asset.resource);        
        }

        /**
         * Inserts an image at the current cursor position.
         */
        var insertImage = function (image) {
            var cursorPosition = editor.selection.getRange().start,
                line = editor.session.getLine(cursorPosition.row);

            // inserting media URL between two quotes
            if (line.substr(cursorPosition.column - 5, 5).toLowerCase() === 'src="') {
                editor.insert(image.resource);
                return;
            }

            // inserting media URL with quotes
            if (line.substr(cursorPosition.column - 4, 4).toLowerCase() === 'src=') {
                editor.insert('"' + image.resource + '"');
                return;
            }

            // inserting media as an inline style
            if (line.substr(cursorPosition.column - 4, 4).toLowerCase() === 'url(') {
                editor.insert(image.resource);
                return;
            }

            // ensure that the current cursor position warrants a complete img HTML
            // tag instead of the URL.
            var character = line.substr(cursorPosition.column - 1, 1).toLowerCase()

            if (character === '>' || character === '' || character === ' ') {
                editor.insert('<img src="' + image.resource + '" alt="' + image.alternateText + '" class="" />\n');
                return;
            }

            editor.insert(image.resource);
        };

        /**
         * Inserts HTML into editor.
         */
        var insertHTML = function (e) {
            if (!e || !e.detail || !e.detail.html) {
                return;
            }

            editor.insert(e.detail.html);
        };

        /**
         * Updates hidden HTML input with latest content from Ace editor.
         */
        var update = function () {
            $input.value = session.getValue();
        };

        var updateSession = function () {
            session.setValue($input.value);
        };

        init();
    }
});
/**
 * Editor can be toggled between code / visual editor.
 */

window.Editor.plugins.push({
    action: 'context',
    init: true,
    exec: function (instance) {
        var CSS_CODE_EDITOR = 'is-code-editor',
            CSS_VISUAL_EDITOR = 'is-visual-editor',
            $visualIFrame = instance.$el.querySelector('.js-editor-visual-iframe');

        /**
         * Returns the type of content
         */
        var getContentType = function () {
            return document.querySelector('.js-editor-content-type').value;
        };

        var sendMessage = function (msg) {
            $visualIFrame.contentWindow.postMessage(JSON.stringify(msg), '*');
        };

        var toggleCodeEditor = function () {
            instance.$el.classList.remove(CSS_VISUAL_EDITOR);
            instance.$el.classList.add(CSS_CODE_EDITOR);

            instance.$el.dispatchEvent(new Event('editor:valueUpdate'));
        };

        /**
         * Displays visual editor.
         */
        var toggleVisualEditor = function () {
            // send information to iframe.
            var message = {
                action: 'update',
                value: instance.$input.value,
                mediaPath: getContentType(),
                id: instance.id
            };

            $visualIFrame.contentWindow.postMessage(JSON.stringify(message), '*');

            instance.$el.classList.remove(CSS_CODE_EDITOR);
            instance.$el.classList.add(CSS_VISUAL_EDITOR);
        };


        if (instance.$el.classList.contains(CSS_CODE_EDITOR)) {
            toggleVisualEditor();
            return;
        }

        toggleCodeEditor();
    }
});
/**
 * Switches editor between fullscreen and normal.
 */

window.Editor.plugins.push({
    action: 'toggle-fullscreen',
    init: false,
    exec: function (instance) {
        var CSS_FULLSCREEN = 'is-fullscreen',
            KEY_ESC = 27;

        var toggleFullscreen = function (e) {
            if (e && e.keyCode !== KEY_ESC) {
                return;
            }
    
            if (instance.$el.classList.contains(CSS_FULLSCREEN)) {
                instance.$el.classList.remove(CSS_FULLSCREEN);
    
                document.querySelector('html').style.overflow = '';
                window.removeEventListener('keydown', toggleFullscreen);
                return;
            }
    
            instance.$el.classList.add(CSS_FULLSCREEN);
            document.querySelector('html').style.overflow = 'hidden';
    
            window.addEventListener('keydown', toggleFullscreen);
        };

        toggleFullscreen();
    }
});
/**
 * Inserts embedded video (e.g. YouTube) into the editor.
 */

window.Editor.plugins.push({
    action: 'insert-embed',
    init: false,
    exec: function (instance) {
        var CSS_ACTIVE_DIALOG = 'has-active-dialog';

        var $toolbar = instance.$el.querySelector('.js-editor-toolbar'),
            $dialog = document.createElement('div'),
            $input, $example, $cancelBtn, $insertBtn;

        $dialog.classList.add('editor-dialog');
        $dialog.classList.add('js-editor-dialog');
        $dialog.innerHTML = '<div class="editor-dialog__content"><input type="text" placeholder="Enter URL to YouTube or Vimeo video" class="text large js-embed-url" /><div class="editor-dialog__example js-embed-example"></div><div class="editor-dialog__options"><button type="button" class="js-insert-btn" disabled>Insert</button><button type="button" class="editor-dialog__cancel-btn js-cancel-btn">Cancel</button></div></div>';

        $toolbar.appendChild($dialog);

        $example = $dialog.querySelector('.js-embed-example');
        $input = $dialog.querySelector('.js-embed-url');
        $cancelBtn = $dialog.querySelector('.js-cancel-btn');
        $insertBtn = $dialog.querySelector('.js-insert-btn');

        var buildVimeoHtml = function (url) {
            var videoId = url.substring(url.lastIndexOf('/') + 1);
            return '<div class="embed">\n\t<div class="embed__media">\n\t\t<iframe src="https://player.vimeo.com/video/' + videoId + '" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n\t</div>\n</div>\n\n';
        };

        var buildYoutubeHtml = function (url) {
            var videoId;

            if (url.indexOf('youtu.be/') >= 0 || url.indexOf('youtube.com/embed') >= 0) {
                videoId = url.substring(url.lastIndexOf('/') + 1);
            } else {
                videoId = url.substring(url.lastIndexOf('v=') + 2);
            }

            return '<div class="embed">\n\t<div class="embed__media">\n\t\t<iframe src="https://www.youtube.com/embed/' + videoId + '" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n\t</div>\n</div>\n\n';
        };

        /**
         * Removes dialog.
         */
        var cancel = function () {
            $dialog.remove();

            instance.$el.classList.remove(CSS_ACTIVE_DIALOG);
        };

        /**
         * Dispatches event to insert HTML into editor.
         */
        var insert = function () {
            instance.$el.dispatchEvent(new CustomEvent('editor:insertHtml', {
                detail: {
                    html: $example.innerHTML
                }
            }));

            cancel();
        };

        /**
         * Displays sample of embedded video with option to insert.
         */
        var setExample = function (e) {
            var value = e.currentTarget.value,
                exampleHtml = value ? '<p style="font-size: 0.85em;">Invalid URL (currently only supports Vimeo/YouTube URLs)</p>' : '';

            $insertBtn.disabled = true;

            if (value.indexOf('vimeo.com') >= 0) {
                exampleHtml = buildVimeoHtml(value);
                $insertBtn.disabled = false;
            } else if (value.indexOf('youtube.com') >= 0 || value.indexOf('youtu.be' >= 0)) {
                exampleHtml = buildYoutubeHtml(value);
                $insertBtn.disabled = false;
            }

            
            $example.innerHTML = exampleHtml;
        };

        $input.addEventListener('input', setExample);
        $cancelBtn.addEventListener('click', cancel);
        $insertBtn.addEventListener('click', insert);

        $input.focus();

        instance.$el.classList.add(CSS_ACTIVE_DIALOG);
    }
});
/**
 * Inserts media into the editor from the Orchard media library.
 */

window.Editor.plugins.push({
    action: 'insert-media',
    init: false,
    exec: function (instance) {
        var adminIndex = location.href.toLowerCase().indexOf("/admin/"),
            cachedScrollPosition = 0;

        if (adminIndex === -1) {
            return;
        }

        $.colorbox({
            href: location.href.substr(0, adminIndex) + "/Admin/Orchard.MediaLibrary?dialog=true",
            iframe: true,
            reposition: true,
            width: '90%',
            height: '90%',
            onLoad: function () {
                cachedScrollPosition = $('html').scrollTop();
                // hide the scrollbars from the main window
                $('html, body').css('overflow', 'hidden');
            },
            onClosed: function () {
                var selectedData = $.colorbox.selectedData;

                $('html, body').css('overflow', '');
                $('html').scrollTop(cachedScrollPosition);

                if(!selectedData || selectedData.length === 0) {
                    return;
                }
                
                instance.$el.dispatchEvent(new CustomEvent('editor:addMedia', {
                    detail: {
                        mediaItems: selectedData
                    }
                }));
            }
        });
    }
});
/**
 * Editor can be resized to custom height.
 */

window.Editor.plugins.push({
    action: 'resize',
    init: true,
    exec: function (instance) {
        var initialY, initialHeight,
            $resizer = instance.$el.querySelector('.js-editor-resizer'),
            $visualIFrame = instance.$el.querySelector('.js-editor-visual-iframe');
        
        var dispose = function () {
            window.removeEventListener('mousemove', onDrag);
            window.removeEventListener('mouseup', dispose);
            $visualIFrame.contentWindow.removeEventListener('mousemove', onIFrameDrag);
            $visualIFrame.contentWindow.removeEventListener('mouseup', dispose);
        };

        var onDrag = function (e) {
            instance.$el.style.height = (initialHeight + (e.clientY - initialY)) + 'px';
        };

        var onIFrameDrag = function (e) {
            var boundingClientRect = $visualIFrame.getBoundingClientRect(),
                evt = new CustomEvent('mousemove', { bubbles: true, cancelable: false });

            evt.clientX = e.clientX + boundingClientRect.left;
            evt.clientY = e.clientY + boundingClientRect.top;

            $visualIFrame.dispatchEvent(evt);
        };

        $resizer.addEventListener('mousedown', function (e) {
            initialY = e.clientY;
            initialHeight = instance.$el.offsetHeight;

            window.addEventListener('mousemove', onDrag);
            window.addEventListener('mouseup', dispose);
            $visualIFrame.contentWindow.addEventListener('mousemove', onIFrameDrag);
            $visualIFrame.contentWindow.addEventListener('mouseup', dispose);
        });
    }
});
(function () {
    var editorInstance = function ($el) {
        var state = {
            $el: $el,
            id: $el.getAttribute('data-id')
        };

        /**
         * User has clicked an action within the toolbar.
         */
        var handleAction = function (e) {
            var action = e.currentTarget.getAttribute('data-action'),
                plugins = window.Editor.plugins;

            for (var i = 0; i < plugins.length; i++) {
                if (plugins[i].action === action) {
                    plugins[i].exec(state);
                    return;
                }
            }
        }

        /**
         * Initialises Medium editor.
         */
        var init = function () {
            state.$input = $el.querySelector('.editor-input');

            var $actions = $el.querySelectorAll('.js-toolbar-btn');

            for (var i = 0; i < $actions.length; i++) {
                $actions[i].addEventListener('click', handleAction);
            }

            window.addEventListener('message', onMessage);

            // loop over plugins and execute any that are flagged to
            // exec on initialise.
            for (var i = 0; i < window.Editor.plugins.length; i++) {
                if (window.Editor.plugins[i].init) {
                    window.Editor.plugins[i].exec(state);
                }
            }
        };

        /**
         * Received a message from the iframe editor.
         */
        var onMessage = function (e) {
            if (e.data.id !== state.id) {
                return;
            }

            if (e.data.action === 'update') {
                state.$input.value = html_beautify ? html_beautify(e.data.value, { wrap_line_length: 0 }) : e.data.value;
                $el.dispatchEvent(new Event('editor:valueUpdate'));
            }
        };

        init();
    }

    /**
     * Initialises instances of the Ace editor.
     */
    var initialise = function () {
        var $editors = document.querySelectorAll('.js-editor');

        for (var i = 0; i < $editors.length; i++) {
            editorInstance($editors[i]);
        }
    };

    document.addEventListener('DOMContentLoaded', initialise);
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9yY2hhcmQuZWRpdG9yLmpzIiwiZWRpdG9yLmFjZS5qcyIsImVkaXRvci5jb250ZXh0LmpzIiwiZWRpdG9yLmZ1bGxzY3JlZW4uanMiLCJlZGl0b3IuaW5zZXJ0RW1iZWQuanMiLCJlZGl0b3IuaW5zZXJ0TWVkaWEuanMiLCJlZGl0b3IucmVzaXplci5qcyIsIm9yY2hhcmQuZWRpdG9yLmluc3RhbmNlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxBQUxBO0FBQ0E7QUFDQTtBQUNBO0FDSEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDMUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3RkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im9yY2hhcmQuZWRpdG9yLmpzIiwic291cmNlc0NvbnRlbnQiOlsid2luZG93LkVkaXRvciA9IHdpbmRvdy5FZGl0b3IgfHwge1xyXG4gICAgcGx1Z2luczogW10sXHJcbiAgICBpbnN0YW5jZXM6IFtdXHJcbn07Iiwid2luZG93LkVkaXRvci5wbHVnaW5zLnB1c2goe1xyXG4gICAgYWN0aW9uOiAnYWNlJyxcclxuICAgIGluaXQ6IHRydWUsXHJcbiAgICBleGVjOiBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcclxuICAgICAgICB2YXIgZWRpdG9yLCBzZXNzaW9uLCAkaW5wdXQ7XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEFkZCBwcm92aWRlZCBtZWRpYSB0byBlZGl0b3IsIGRpY3RhdGVkIGJ5IGN1cnJlbnQgYWNlIGVkaXRvciBzZWxlY3Rpb24gc3RhdGUuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGFkZE1lZGlhID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKCFlIHx8ICFlLmRldGFpbCB8fCAhZS5kZXRhaWwubWVkaWFJdGVtcykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGUuZGV0YWlsLm1lZGlhSXRlbXMubGVuZ3RoOyBpKyspIHtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoZS5kZXRhaWwubWVkaWFJdGVtc1tpXS5jb250ZW50VHlwZS50b0xvd2VyQ2FzZSgpID09PSAnZG9jdW1lbnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0RG9jdW1lbnQoZS5kZXRhaWwubWVkaWFJdGVtc1tpXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgaWYgKGUuZGV0YWlsLm1lZGlhSXRlbXNbaV0uY29udGVudFR5cGUudG9Mb3dlckNhc2UoKSA9PT0gJ2ltYWdlJyB8fCBlLmRldGFpbC5tZWRpYUl0ZW1zW2ldLmNvbnRlbnRUeXBlLnRvTG93ZXJDYXNlKCkgPT09ICd2ZWN0b3JpbWFnZScpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnNlcnRJbWFnZShlLmRldGFpbC5tZWRpYUl0ZW1zW2ldKTtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEZpbHRlcnMgb3V0IHVud2FudGVkIGFubm90YXRpb25zIChlLmcuIHdhcm5pbmcgYWJvdXQgZG9jdHlwZSkgZHVlIHRvIGNvbW1vblxyXG4gICAgICAgICAqIGNhc2UgaXMgdGhlIEhUTUwgYmVpbmcgZWRpdGVkIGlzIG5vdCBhIGZ1bGwgSFRNTCBkb2N1bWVudCBidXQgYSBwaWVjZSBvZiBIVE1MLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBmaWx0ZXJBbm5vdGF0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgYW5ub3RhdGlvbnMgPSBzZXNzaW9uLmdldEFubm90YXRpb25zKCkgfHwgW10sIGkgPSBsZW4gPSBhbm5vdGF0aW9ucy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoL2RvY3R5cGUgZmlyc3RcXC4gRXhwZWN0ZWQvLnRlc3QoYW5ub3RhdGlvbnNbaV0udGV4dCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBhbm5vdGF0aW9ucy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChsZW4gPiBhbm5vdGF0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHNlc3Npb24uc2V0QW5ub3RhdGlvbnMoYW5ub3RhdGlvbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUmV0dXJucyB0ZXh0YXJlYSB0aGF0IG5lZWRzIHRvIGdldCB0dXJuZWQgaW50byBBY2UgZWRpdG9yLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBnZXRUZXh0QXJlYSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluc3RhbmNlLiRlbC5xdWVyeVNlbGVjdG9yKCcuanMtZWRpdG9yLWNvZGUgPiB0ZXh0YXJlYScpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluaXRpYWxpc2VzIEFjZSBlZGl0b3IuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGVkaXRvciA9IGFjZS5lZGl0KGdldFRleHRBcmVhKCkuaWQpO1xyXG4gICAgICAgICAgICBzZXNzaW9uID0gZWRpdG9yLmdldFNlc3Npb24oKTtcclxuXHJcbiAgICAgICAgICAgICRpbnB1dCA9IGluc3RhbmNlLiRlbC5xdWVyeVNlbGVjdG9yKCcuZWRpdG9yLWlucHV0Jyk7XHJcblxyXG4gICAgICAgICAgICBlZGl0b3Iuc2V0VGhlbWUoJ2FjZS90aGVtZS9tb25va2FpJyk7XHJcbiAgICAgICAgICAgIGVkaXRvci5zZXRTaG93UHJpbnRNYXJnaW4oZmFsc2UpO1xyXG4gICAgICAgICAgICBlZGl0b3IuJGJsb2NrU2Nyb2xsaW5nID0gSW5maW5pdHk7XHJcblxyXG4gICAgICAgICAgICBzZXNzaW9uLnNldE1vZGUoJ2FjZS9tb2RlL2h0bWwnKTtcclxuICAgICAgICAgICAgc2Vzc2lvbi5zZXRVc2VXcmFwTW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgICAgIHNlc3Npb24ub24oJ2NoYW5nZUFubm90YXRpb24nLCBmaWx0ZXJBbm5vdGF0aW9uKTtcclxuICAgICAgICAgICAgc2Vzc2lvbi5vbignY2hhbmdlJywgdXBkYXRlKTtcclxuXHJcbiAgICAgICAgICAgICRpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCB1cGRhdGVTZXNzaW9uKTtcclxuICAgICAgICAgICAgaW5zdGFuY2UuJGVsLmFkZEV2ZW50TGlzdGVuZXIoJ2VkaXRvcjp2YWx1ZVVwZGF0ZScsIHVwZGF0ZVNlc3Npb24pO1xyXG4gICAgICAgICAgICBpbnN0YW5jZS4kZWwuYWRkRXZlbnRMaXN0ZW5lcignZWRpdG9yOmFkZE1lZGlhJywgYWRkTWVkaWEpO1xyXG4gICAgICAgICAgICBpbnN0YW5jZS4kZWwuYWRkRXZlbnRMaXN0ZW5lcignZWRpdG9yOmluc2VydEh0bWwnLCBpbnNlcnRIVE1MKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbnNlcnRzIGh5cGVybGluayBmb3IgZG9jdW1lbnQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGluc2VydERvY3VtZW50ID0gZnVuY3Rpb24oYXNzZXQpIHtcclxuICAgICAgICAgICAgdmFyIGN1cnNvclBvc2l0aW9uID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRSYW5nZSgpLnN0YXJ0LFxyXG4gICAgICAgICAgICAgICAgbGluZSA9IGVkaXRvci5zZXNzaW9uLmdldExpbmUoY3Vyc29yUG9zaXRpb24ucm93KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluc2VydGluZyBtZWRpYSBVUkwgYmV0d2VlbiB0d28gcXVvdGVzXHJcbiAgICAgICAgICAgIGlmIChsaW5lLnN1YnN0cihjdXJzb3JQb3NpdGlvbi5jb2x1bW4gLSA1LCA1KS50b0xvd2VyQ2FzZSgpID09PSAnaHJlZj1cIicpIHtcclxuICAgICAgICAgICAgICAgIGVkaXRvci5pbnNlcnQoYXNzZXQucmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBpbnNlcnRpbmcgbWVkaWEgVVJMIHdpdGggcXVvdGVzXHJcbiAgICAgICAgICAgIGlmIChsaW5lLnN1YnN0cihjdXJzb3JQb3NpdGlvbi5jb2x1bW4gLSA0LCA0KS50b0xvd2VyQ2FzZSgpID09PSAnaHJlZj0nKSB7XHJcbiAgICAgICAgICAgICAgICBlZGl0b3IuaW5zZXJ0KCdcIicgKyBhc3NldC5yZXNvdXJjZSArICdcIicpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAvLyBlbnN1cmUgdGhhdCB0aGUgY3VycmVudCBjdXJzb3IgcG9zaXRpb24gd2FycmFudHMgYSBjb21wbGV0ZSBhbmNob3IgSFRNTFxyXG4gICAgICAgICAgICAvLyB0YWcgaW5zdGVhZCBvZiB0aGUgVVJMLlxyXG4gICAgICAgICAgICB2YXIgY2hhcmFjdGVyID0gbGluZS5zdWJzdHIoY3Vyc29yUG9zaXRpb24uY29sdW1uIC0gMSwgMSkudG9Mb3dlckNhc2UoKVxyXG5cclxuICAgICAgICAgICAgaWYgKGNoYXJhY3RlciA9PT0gJz4nIHx8IGNoYXJhY3RlciA9PT0gJycgfHwgY2hhcmFjdGVyID09PSAnICcpIHtcclxuICAgICAgICAgICAgICAgIGVkaXRvci5pbnNlcnQoJzxhIGhyZWY9XCInICsgYXNzZXQucmVzb3VyY2UgKyAnXCIgdGl0bGU9XCInICsgYXNzZXQuYWx0ZXJuYXRlVGV4dCArICdcIiBjbGFzcz1cIlwiIC8+XFxuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGVkaXRvci5pbnNlcnQoYXNzZXQucmVzb3VyY2UpOyAgICAgICAgXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbnNlcnRzIGFuIGltYWdlIGF0IHRoZSBjdXJyZW50IGN1cnNvciBwb3NpdGlvbi5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgaW5zZXJ0SW1hZ2UgPSBmdW5jdGlvbiAoaW1hZ2UpIHtcclxuICAgICAgICAgICAgdmFyIGN1cnNvclBvc2l0aW9uID0gZWRpdG9yLnNlbGVjdGlvbi5nZXRSYW5nZSgpLnN0YXJ0LFxyXG4gICAgICAgICAgICAgICAgbGluZSA9IGVkaXRvci5zZXNzaW9uLmdldExpbmUoY3Vyc29yUG9zaXRpb24ucm93KTtcclxuXHJcbiAgICAgICAgICAgIC8vIGluc2VydGluZyBtZWRpYSBVUkwgYmV0d2VlbiB0d28gcXVvdGVzXHJcbiAgICAgICAgICAgIGlmIChsaW5lLnN1YnN0cihjdXJzb3JQb3NpdGlvbi5jb2x1bW4gLSA1LCA1KS50b0xvd2VyQ2FzZSgpID09PSAnc3JjPVwiJykge1xyXG4gICAgICAgICAgICAgICAgZWRpdG9yLmluc2VydChpbWFnZS5yZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIC8vIGluc2VydGluZyBtZWRpYSBVUkwgd2l0aCBxdW90ZXNcclxuICAgICAgICAgICAgaWYgKGxpbmUuc3Vic3RyKGN1cnNvclBvc2l0aW9uLmNvbHVtbiAtIDQsIDQpLnRvTG93ZXJDYXNlKCkgPT09ICdzcmM9Jykge1xyXG4gICAgICAgICAgICAgICAgZWRpdG9yLmluc2VydCgnXCInICsgaW1hZ2UucmVzb3VyY2UgKyAnXCInKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gaW5zZXJ0aW5nIG1lZGlhIGFzIGFuIGlubGluZSBzdHlsZVxyXG4gICAgICAgICAgICBpZiAobGluZS5zdWJzdHIoY3Vyc29yUG9zaXRpb24uY29sdW1uIC0gNCwgNCkudG9Mb3dlckNhc2UoKSA9PT0gJ3VybCgnKSB7XHJcbiAgICAgICAgICAgICAgICBlZGl0b3IuaW5zZXJ0KGltYWdlLnJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy8gZW5zdXJlIHRoYXQgdGhlIGN1cnJlbnQgY3Vyc29yIHBvc2l0aW9uIHdhcnJhbnRzIGEgY29tcGxldGUgaW1nIEhUTUxcclxuICAgICAgICAgICAgLy8gdGFnIGluc3RlYWQgb2YgdGhlIFVSTC5cclxuICAgICAgICAgICAgdmFyIGNoYXJhY3RlciA9IGxpbmUuc3Vic3RyKGN1cnNvclBvc2l0aW9uLmNvbHVtbiAtIDEsIDEpLnRvTG93ZXJDYXNlKClcclxuXHJcbiAgICAgICAgICAgIGlmIChjaGFyYWN0ZXIgPT09ICc+JyB8fCBjaGFyYWN0ZXIgPT09ICcnIHx8IGNoYXJhY3RlciA9PT0gJyAnKSB7XHJcbiAgICAgICAgICAgICAgICBlZGl0b3IuaW5zZXJ0KCc8aW1nIHNyYz1cIicgKyBpbWFnZS5yZXNvdXJjZSArICdcIiBhbHQ9XCInICsgaW1hZ2UuYWx0ZXJuYXRlVGV4dCArICdcIiBjbGFzcz1cIlwiIC8+XFxuJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGVkaXRvci5pbnNlcnQoaW1hZ2UucmVzb3VyY2UpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEluc2VydHMgSFRNTCBpbnRvIGVkaXRvci5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgaW5zZXJ0SFRNTCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmICghZSB8fCAhZS5kZXRhaWwgfHwgIWUuZGV0YWlsLmh0bWwpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgZWRpdG9yLmluc2VydChlLmRldGFpbC5odG1sKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBVcGRhdGVzIGhpZGRlbiBIVE1MIGlucHV0IHdpdGggbGF0ZXN0IGNvbnRlbnQgZnJvbSBBY2UgZWRpdG9yLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciB1cGRhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRpbnB1dC52YWx1ZSA9IHNlc3Npb24uZ2V0VmFsdWUoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgdXBkYXRlU2Vzc2lvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2Vzc2lvbi5zZXRWYWx1ZSgkaW5wdXQudmFsdWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGluaXQoKTtcclxuICAgIH1cclxufSk7IiwiLyoqXHJcbiAqIEVkaXRvciBjYW4gYmUgdG9nZ2xlZCBiZXR3ZWVuIGNvZGUgLyB2aXN1YWwgZWRpdG9yLlxyXG4gKi9cclxuXHJcbndpbmRvdy5FZGl0b3IucGx1Z2lucy5wdXNoKHtcclxuICAgIGFjdGlvbjogJ2NvbnRleHQnLFxyXG4gICAgaW5pdDogdHJ1ZSxcclxuICAgIGV4ZWM6IGZ1bmN0aW9uIChpbnN0YW5jZSkge1xyXG4gICAgICAgIHZhciBDU1NfQ09ERV9FRElUT1IgPSAnaXMtY29kZS1lZGl0b3InLFxyXG4gICAgICAgICAgICBDU1NfVklTVUFMX0VESVRPUiA9ICdpcy12aXN1YWwtZWRpdG9yJyxcclxuICAgICAgICAgICAgJHZpc3VhbElGcmFtZSA9IGluc3RhbmNlLiRlbC5xdWVyeVNlbGVjdG9yKCcuanMtZWRpdG9yLXZpc3VhbC1pZnJhbWUnKTtcclxuXHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogUmV0dXJucyB0aGUgdHlwZSBvZiBjb250ZW50XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGdldENvbnRlbnRUeXBlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmpzLWVkaXRvci1jb250ZW50LXR5cGUnKS52YWx1ZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgc2VuZE1lc3NhZ2UgPSBmdW5jdGlvbiAobXNnKSB7XHJcbiAgICAgICAgICAgICR2aXN1YWxJRnJhbWUuY29udGVudFdpbmRvdy5wb3N0TWVzc2FnZShKU09OLnN0cmluZ2lmeShtc2cpLCAnKicpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciB0b2dnbGVDb2RlRWRpdG9yID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS4kZWwuY2xhc3NMaXN0LnJlbW92ZShDU1NfVklTVUFMX0VESVRPUik7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLiRlbC5jbGFzc0xpc3QuYWRkKENTU19DT0RFX0VESVRPUik7XHJcblxyXG4gICAgICAgICAgICBpbnN0YW5jZS4kZWwuZGlzcGF0Y2hFdmVudChuZXcgRXZlbnQoJ2VkaXRvcjp2YWx1ZVVwZGF0ZScpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEaXNwbGF5cyB2aXN1YWwgZWRpdG9yLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciB0b2dnbGVWaXN1YWxFZGl0b3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIHNlbmQgaW5mb3JtYXRpb24gdG8gaWZyYW1lLlxyXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHtcclxuICAgICAgICAgICAgICAgIGFjdGlvbjogJ3VwZGF0ZScsXHJcbiAgICAgICAgICAgICAgICB2YWx1ZTogaW5zdGFuY2UuJGlucHV0LnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgbWVkaWFQYXRoOiBnZXRDb250ZW50VHlwZSgpLFxyXG4gICAgICAgICAgICAgICAgaWQ6IGluc3RhbmNlLmlkXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICAkdmlzdWFsSUZyYW1lLmNvbnRlbnRXaW5kb3cucG9zdE1lc3NhZ2UoSlNPTi5zdHJpbmdpZnkobWVzc2FnZSksICcqJyk7XHJcblxyXG4gICAgICAgICAgICBpbnN0YW5jZS4kZWwuY2xhc3NMaXN0LnJlbW92ZShDU1NfQ09ERV9FRElUT1IpO1xyXG4gICAgICAgICAgICBpbnN0YW5jZS4kZWwuY2xhc3NMaXN0LmFkZChDU1NfVklTVUFMX0VESVRPUik7XHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIGlmIChpbnN0YW5jZS4kZWwuY2xhc3NMaXN0LmNvbnRhaW5zKENTU19DT0RFX0VESVRPUikpIHtcclxuICAgICAgICAgICAgdG9nZ2xlVmlzdWFsRWRpdG9yKCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRvZ2dsZUNvZGVFZGl0b3IoKTtcclxuICAgIH1cclxufSk7IiwiLyoqXHJcbiAqIFN3aXRjaGVzIGVkaXRvciBiZXR3ZWVuIGZ1bGxzY3JlZW4gYW5kIG5vcm1hbC5cclxuICovXHJcblxyXG53aW5kb3cuRWRpdG9yLnBsdWdpbnMucHVzaCh7XHJcbiAgICBhY3Rpb246ICd0b2dnbGUtZnVsbHNjcmVlbicsXHJcbiAgICBpbml0OiBmYWxzZSxcclxuICAgIGV4ZWM6IGZ1bmN0aW9uIChpbnN0YW5jZSkge1xyXG4gICAgICAgIHZhciBDU1NfRlVMTFNDUkVFTiA9ICdpcy1mdWxsc2NyZWVuJyxcclxuICAgICAgICAgICAgS0VZX0VTQyA9IDI3O1xyXG5cclxuICAgICAgICB2YXIgdG9nZ2xlRnVsbHNjcmVlbiA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGlmIChlICYmIGUua2V5Q29kZSAhPT0gS0VZX0VTQykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICBcclxuICAgICAgICAgICAgaWYgKGluc3RhbmNlLiRlbC5jbGFzc0xpc3QuY29udGFpbnMoQ1NTX0ZVTExTQ1JFRU4pKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS4kZWwuY2xhc3NMaXN0LnJlbW92ZShDU1NfRlVMTFNDUkVFTik7XHJcbiAgICBcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2h0bWwnKS5zdHlsZS5vdmVyZmxvdyA9ICcnO1xyXG4gICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0b2dnbGVGdWxsc2NyZWVuKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgXHJcbiAgICAgICAgICAgIGluc3RhbmNlLiRlbC5jbGFzc0xpc3QuYWRkKENTU19GVUxMU0NSRUVOKTtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaHRtbCcpLnN0eWxlLm92ZXJmbG93ID0gJ2hpZGRlbic7XHJcbiAgICBcclxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0b2dnbGVGdWxsc2NyZWVuKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0b2dnbGVGdWxsc2NyZWVuKCk7XHJcbiAgICB9XHJcbn0pOyIsIi8qKlxyXG4gKiBJbnNlcnRzIGVtYmVkZGVkIHZpZGVvIChlLmcuIFlvdVR1YmUpIGludG8gdGhlIGVkaXRvci5cclxuICovXHJcblxyXG53aW5kb3cuRWRpdG9yLnBsdWdpbnMucHVzaCh7XHJcbiAgICBhY3Rpb246ICdpbnNlcnQtZW1iZWQnLFxyXG4gICAgaW5pdDogZmFsc2UsXHJcbiAgICBleGVjOiBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcclxuICAgICAgICB2YXIgQ1NTX0FDVElWRV9ESUFMT0cgPSAnaGFzLWFjdGl2ZS1kaWFsb2cnO1xyXG5cclxuICAgICAgICB2YXIgJHRvb2xiYXIgPSBpbnN0YW5jZS4kZWwucXVlcnlTZWxlY3RvcignLmpzLWVkaXRvci10b29sYmFyJyksXHJcbiAgICAgICAgICAgICRkaWFsb2cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSxcclxuICAgICAgICAgICAgJGlucHV0LCAkZXhhbXBsZSwgJGNhbmNlbEJ0biwgJGluc2VydEJ0bjtcclxuXHJcbiAgICAgICAgJGRpYWxvZy5jbGFzc0xpc3QuYWRkKCdlZGl0b3ItZGlhbG9nJyk7XHJcbiAgICAgICAgJGRpYWxvZy5jbGFzc0xpc3QuYWRkKCdqcy1lZGl0b3ItZGlhbG9nJyk7XHJcbiAgICAgICAgJGRpYWxvZy5pbm5lckhUTUwgPSAnPGRpdiBjbGFzcz1cImVkaXRvci1kaWFsb2dfX2NvbnRlbnRcIj48aW5wdXQgdHlwZT1cInRleHRcIiBwbGFjZWhvbGRlcj1cIkVudGVyIFVSTCB0byBZb3VUdWJlIG9yIFZpbWVvIHZpZGVvXCIgY2xhc3M9XCJ0ZXh0IGxhcmdlIGpzLWVtYmVkLXVybFwiIC8+PGRpdiBjbGFzcz1cImVkaXRvci1kaWFsb2dfX2V4YW1wbGUganMtZW1iZWQtZXhhbXBsZVwiPjwvZGl2PjxkaXYgY2xhc3M9XCJlZGl0b3ItZGlhbG9nX19vcHRpb25zXCI+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJqcy1pbnNlcnQtYnRuXCIgZGlzYWJsZWQ+SW5zZXJ0PC9idXR0b24+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJlZGl0b3ItZGlhbG9nX19jYW5jZWwtYnRuIGpzLWNhbmNlbC1idG5cIj5DYW5jZWw8L2J1dHRvbj48L2Rpdj48L2Rpdj4nO1xyXG5cclxuICAgICAgICAkdG9vbGJhci5hcHBlbmRDaGlsZCgkZGlhbG9nKTtcclxuXHJcbiAgICAgICAgJGV4YW1wbGUgPSAkZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoJy5qcy1lbWJlZC1leGFtcGxlJyk7XHJcbiAgICAgICAgJGlucHV0ID0gJGRpYWxvZy5xdWVyeVNlbGVjdG9yKCcuanMtZW1iZWQtdXJsJyk7XHJcbiAgICAgICAgJGNhbmNlbEJ0biA9ICRkaWFsb2cucXVlcnlTZWxlY3RvcignLmpzLWNhbmNlbC1idG4nKTtcclxuICAgICAgICAkaW5zZXJ0QnRuID0gJGRpYWxvZy5xdWVyeVNlbGVjdG9yKCcuanMtaW5zZXJ0LWJ0bicpO1xyXG5cclxuICAgICAgICB2YXIgYnVpbGRWaW1lb0h0bWwgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgICAgIHZhciB2aWRlb0lkID0gdXJsLnN1YnN0cmluZyh1cmwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xyXG4gICAgICAgICAgICByZXR1cm4gJzxkaXYgY2xhc3M9XCJlbWJlZFwiPlxcblxcdDxkaXYgY2xhc3M9XCJlbWJlZF9fbWVkaWFcIj5cXG5cXHRcXHQ8aWZyYW1lIHNyYz1cImh0dHBzOi8vcGxheWVyLnZpbWVvLmNvbS92aWRlby8nICsgdmlkZW9JZCArICdcIiBmcmFtZWJvcmRlcj1cIjBcIiB3ZWJraXRhbGxvd2Z1bGxzY3JlZW4gbW96YWxsb3dmdWxsc2NyZWVuIGFsbG93ZnVsbHNjcmVlbj48L2lmcmFtZT5cXG5cXHQ8L2Rpdj5cXG48L2Rpdj5cXG5cXG4nO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZhciBidWlsZFlvdXR1YmVIdG1sID0gZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgICAgICB2YXIgdmlkZW9JZDtcclxuXHJcbiAgICAgICAgICAgIGlmICh1cmwuaW5kZXhPZigneW91dHUuYmUvJykgPj0gMCB8fCB1cmwuaW5kZXhPZigneW91dHViZS5jb20vZW1iZWQnKSA+PSAwKSB7XHJcbiAgICAgICAgICAgICAgICB2aWRlb0lkID0gdXJsLnN1YnN0cmluZyh1cmwubGFzdEluZGV4T2YoJy8nKSArIDEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdmlkZW9JZCA9IHVybC5zdWJzdHJpbmcodXJsLmxhc3RJbmRleE9mKCd2PScpICsgMik7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiAnPGRpdiBjbGFzcz1cImVtYmVkXCI+XFxuXFx0PGRpdiBjbGFzcz1cImVtYmVkX19tZWRpYVwiPlxcblxcdFxcdDxpZnJhbWUgc3JjPVwiaHR0cHM6Ly93d3cueW91dHViZS5jb20vZW1iZWQvJyArIHZpZGVvSWQgKyAnXCIgZnJhbWVib3JkZXI9XCIwXCIgd2Via2l0YWxsb3dmdWxsc2NyZWVuIG1vemFsbG93ZnVsbHNjcmVlbiBhbGxvd2Z1bGxzY3JlZW4+PC9pZnJhbWU+XFxuXFx0PC9kaXY+XFxuPC9kaXY+XFxuXFxuJztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBSZW1vdmVzIGRpYWxvZy5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkZGlhbG9nLnJlbW92ZSgpO1xyXG5cclxuICAgICAgICAgICAgaW5zdGFuY2UuJGVsLmNsYXNzTGlzdC5yZW1vdmUoQ1NTX0FDVElWRV9ESUFMT0cpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERpc3BhdGNoZXMgZXZlbnQgdG8gaW5zZXJ0IEhUTUwgaW50byBlZGl0b3IuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdmFyIGluc2VydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaW5zdGFuY2UuJGVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdlZGl0b3I6aW5zZXJ0SHRtbCcsIHtcclxuICAgICAgICAgICAgICAgIGRldGFpbDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGh0bWw6ICRleGFtcGxlLmlubmVySFRNTFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KSk7XHJcblxyXG4gICAgICAgICAgICBjYW5jZWwoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEaXNwbGF5cyBzYW1wbGUgb2YgZW1iZWRkZWQgdmlkZW8gd2l0aCBvcHRpb24gdG8gaW5zZXJ0LlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBzZXRFeGFtcGxlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gZS5jdXJyZW50VGFyZ2V0LnZhbHVlLFxyXG4gICAgICAgICAgICAgICAgZXhhbXBsZUh0bWwgPSB2YWx1ZSA/ICc8cCBzdHlsZT1cImZvbnQtc2l6ZTogMC44NWVtO1wiPkludmFsaWQgVVJMIChjdXJyZW50bHkgb25seSBzdXBwb3J0cyBWaW1lby9Zb3VUdWJlIFVSTHMpPC9wPicgOiAnJztcclxuXHJcbiAgICAgICAgICAgICRpbnNlcnRCdG4uZGlzYWJsZWQgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJ3ZpbWVvLmNvbScpID49IDApIHtcclxuICAgICAgICAgICAgICAgIGV4YW1wbGVIdG1sID0gYnVpbGRWaW1lb0h0bWwodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgJGluc2VydEJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZhbHVlLmluZGV4T2YoJ3lvdXR1YmUuY29tJykgPj0gMCB8fCB2YWx1ZS5pbmRleE9mKCd5b3V0dS5iZScgPj0gMCkpIHtcclxuICAgICAgICAgICAgICAgIGV4YW1wbGVIdG1sID0gYnVpbGRZb3V0dWJlSHRtbCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAkaW5zZXJ0QnRuLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAkZXhhbXBsZS5pbm5lckhUTUwgPSBleGFtcGxlSHRtbDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBzZXRFeGFtcGxlKTtcclxuICAgICAgICAkY2FuY2VsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2FuY2VsKTtcclxuICAgICAgICAkaW5zZXJ0QnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgaW5zZXJ0KTtcclxuXHJcbiAgICAgICAgJGlucHV0LmZvY3VzKCk7XHJcblxyXG4gICAgICAgIGluc3RhbmNlLiRlbC5jbGFzc0xpc3QuYWRkKENTU19BQ1RJVkVfRElBTE9HKTtcclxuICAgIH1cclxufSk7IiwiLyoqXHJcbiAqIEluc2VydHMgbWVkaWEgaW50byB0aGUgZWRpdG9yIGZyb20gdGhlIE9yY2hhcmQgbWVkaWEgbGlicmFyeS5cclxuICovXHJcblxyXG53aW5kb3cuRWRpdG9yLnBsdWdpbnMucHVzaCh7XHJcbiAgICBhY3Rpb246ICdpbnNlcnQtbWVkaWEnLFxyXG4gICAgaW5pdDogZmFsc2UsXHJcbiAgICBleGVjOiBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcclxuICAgICAgICB2YXIgYWRtaW5JbmRleCA9IGxvY2F0aW9uLmhyZWYudG9Mb3dlckNhc2UoKS5pbmRleE9mKFwiL2FkbWluL1wiKSxcclxuICAgICAgICAgICAgY2FjaGVkU2Nyb2xsUG9zaXRpb24gPSAwO1xyXG5cclxuICAgICAgICBpZiAoYWRtaW5JbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgJC5jb2xvcmJveCh7XHJcbiAgICAgICAgICAgIGhyZWY6IGxvY2F0aW9uLmhyZWYuc3Vic3RyKDAsIGFkbWluSW5kZXgpICsgXCIvQWRtaW4vT3JjaGFyZC5NZWRpYUxpYnJhcnk/ZGlhbG9nPXRydWVcIixcclxuICAgICAgICAgICAgaWZyYW1lOiB0cnVlLFxyXG4gICAgICAgICAgICByZXBvc2l0aW9uOiB0cnVlLFxyXG4gICAgICAgICAgICB3aWR0aDogJzkwJScsXHJcbiAgICAgICAgICAgIGhlaWdodDogJzkwJScsXHJcbiAgICAgICAgICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgY2FjaGVkU2Nyb2xsUG9zaXRpb24gPSAkKCdodG1sJykuc2Nyb2xsVG9wKCk7XHJcbiAgICAgICAgICAgICAgICAvLyBoaWRlIHRoZSBzY3JvbGxiYXJzIGZyb20gdGhlIG1haW4gd2luZG93XHJcbiAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuY3NzKCdvdmVyZmxvdycsICdoaWRkZW4nKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25DbG9zZWQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZERhdGEgPSAkLmNvbG9yYm94LnNlbGVjdGVkRGF0YTtcclxuXHJcbiAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuY3NzKCdvdmVyZmxvdycsICcnKTtcclxuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5zY3JvbGxUb3AoY2FjaGVkU2Nyb2xsUG9zaXRpb24pO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmKCFzZWxlY3RlZERhdGEgfHwgc2VsZWN0ZWREYXRhLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgaW5zdGFuY2UuJGVsLmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdlZGl0b3I6YWRkTWVkaWEnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lZGlhSXRlbXM6IHNlbGVjdGVkRGF0YVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTsiLCIvKipcclxuICogRWRpdG9yIGNhbiBiZSByZXNpemVkIHRvIGN1c3RvbSBoZWlnaHQuXHJcbiAqL1xyXG5cclxud2luZG93LkVkaXRvci5wbHVnaW5zLnB1c2goe1xyXG4gICAgYWN0aW9uOiAncmVzaXplJyxcclxuICAgIGluaXQ6IHRydWUsXHJcbiAgICBleGVjOiBmdW5jdGlvbiAoaW5zdGFuY2UpIHtcclxuICAgICAgICB2YXIgaW5pdGlhbFksIGluaXRpYWxIZWlnaHQsXHJcbiAgICAgICAgICAgICRyZXNpemVyID0gaW5zdGFuY2UuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5qcy1lZGl0b3ItcmVzaXplcicpLFxyXG4gICAgICAgICAgICAkdmlzdWFsSUZyYW1lID0gaW5zdGFuY2UuJGVsLnF1ZXJ5U2VsZWN0b3IoJy5qcy1lZGl0b3ItdmlzdWFsLWlmcmFtZScpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBkaXNwb3NlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25EcmFnKTtcclxuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBkaXNwb3NlKTtcclxuICAgICAgICAgICAgJHZpc3VhbElGcmFtZS5jb250ZW50V2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uSUZyYW1lRHJhZyk7XHJcbiAgICAgICAgICAgICR2aXN1YWxJRnJhbWUuY29udGVudFdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZGlzcG9zZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIG9uRHJhZyA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLiRlbC5zdHlsZS5oZWlnaHQgPSAoaW5pdGlhbEhlaWdodCArIChlLmNsaWVudFkgLSBpbml0aWFsWSkpICsgJ3B4JztcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2YXIgb25JRnJhbWVEcmFnID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIGJvdW5kaW5nQ2xpZW50UmVjdCA9ICR2aXN1YWxJRnJhbWUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXHJcbiAgICAgICAgICAgICAgICBldnQgPSBuZXcgQ3VzdG9tRXZlbnQoJ21vdXNlbW92ZScsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogZmFsc2UgfSk7XHJcblxyXG4gICAgICAgICAgICBldnQuY2xpZW50WCA9IGUuY2xpZW50WCArIGJvdW5kaW5nQ2xpZW50UmVjdC5sZWZ0O1xyXG4gICAgICAgICAgICBldnQuY2xpZW50WSA9IGUuY2xpZW50WSArIGJvdW5kaW5nQ2xpZW50UmVjdC50b3A7XHJcblxyXG4gICAgICAgICAgICAkdmlzdWFsSUZyYW1lLmRpc3BhdGNoRXZlbnQoZXZ0KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAkcmVzaXplci5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBpbml0aWFsWSA9IGUuY2xpZW50WTtcclxuICAgICAgICAgICAgaW5pdGlhbEhlaWdodCA9IGluc3RhbmNlLiRlbC5vZmZzZXRIZWlnaHQ7XHJcblxyXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgb25EcmFnKTtcclxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBkaXNwb3NlKTtcclxuICAgICAgICAgICAgJHZpc3VhbElGcmFtZS5jb250ZW50V2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG9uSUZyYW1lRHJhZyk7XHJcbiAgICAgICAgICAgICR2aXN1YWxJRnJhbWUuY29udGVudFdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZGlzcG9zZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgZWRpdG9ySW5zdGFuY2UgPSBmdW5jdGlvbiAoJGVsKSB7XHJcbiAgICAgICAgdmFyIHN0YXRlID0ge1xyXG4gICAgICAgICAgICAkZWw6ICRlbCxcclxuICAgICAgICAgICAgaWQ6ICRlbC5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFVzZXIgaGFzIGNsaWNrZWQgYW4gYWN0aW9uIHdpdGhpbiB0aGUgdG9vbGJhci5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgaGFuZGxlQWN0aW9uID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIGFjdGlvbiA9IGUuY3VycmVudFRhcmdldC5nZXRBdHRyaWJ1dGUoJ2RhdGEtYWN0aW9uJyksXHJcbiAgICAgICAgICAgICAgICBwbHVnaW5zID0gd2luZG93LkVkaXRvci5wbHVnaW5zO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwbHVnaW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAocGx1Z2luc1tpXS5hY3Rpb24gPT09IGFjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHBsdWdpbnNbaV0uZXhlYyhzdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBJbml0aWFsaXNlcyBNZWRpdW0gZWRpdG9yLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHZhciBpbml0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzdGF0ZS4kaW5wdXQgPSAkZWwucXVlcnlTZWxlY3RvcignLmVkaXRvci1pbnB1dCcpO1xyXG5cclxuICAgICAgICAgICAgdmFyICRhY3Rpb25zID0gJGVsLnF1ZXJ5U2VsZWN0b3JBbGwoJy5qcy10b29sYmFyLWJ0bicpO1xyXG5cclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkYWN0aW9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgJGFjdGlvbnNbaV0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBoYW5kbGVBY3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIG9uTWVzc2FnZSk7XHJcblxyXG4gICAgICAgICAgICAvLyBsb29wIG92ZXIgcGx1Z2lucyBhbmQgZXhlY3V0ZSBhbnkgdGhhdCBhcmUgZmxhZ2dlZCB0b1xyXG4gICAgICAgICAgICAvLyBleGVjIG9uIGluaXRpYWxpc2UuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgd2luZG93LkVkaXRvci5wbHVnaW5zLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAod2luZG93LkVkaXRvci5wbHVnaW5zW2ldLmluaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuRWRpdG9yLnBsdWdpbnNbaV0uZXhlYyhzdGF0ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBSZWNlaXZlZCBhIG1lc3NhZ2UgZnJvbSB0aGUgaWZyYW1lIGVkaXRvci5cclxuICAgICAgICAgKi9cclxuICAgICAgICB2YXIgb25NZXNzYWdlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgaWYgKGUuZGF0YS5pZCAhPT0gc3RhdGUuaWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGUuZGF0YS5hY3Rpb24gPT09ICd1cGRhdGUnKSB7XHJcbiAgICAgICAgICAgICAgICBzdGF0ZS4kaW5wdXQudmFsdWUgPSBodG1sX2JlYXV0aWZ5ID8gaHRtbF9iZWF1dGlmeShlLmRhdGEudmFsdWUsIHsgd3JhcF9saW5lX2xlbmd0aDogMCB9KSA6IGUuZGF0YS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICRlbC5kaXNwYXRjaEV2ZW50KG5ldyBFdmVudCgnZWRpdG9yOnZhbHVlVXBkYXRlJykpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogSW5pdGlhbGlzZXMgaW5zdGFuY2VzIG9mIHRoZSBBY2UgZWRpdG9yLlxyXG4gICAgICovXHJcbiAgICB2YXIgaW5pdGlhbGlzZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgJGVkaXRvcnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuanMtZWRpdG9yJyk7XHJcblxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgJGVkaXRvcnMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgZWRpdG9ySW5zdGFuY2UoJGVkaXRvcnNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGluaXRpYWxpc2UpO1xyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
