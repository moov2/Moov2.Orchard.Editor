!function(){var e=function(e){var t,n,r,o=function(e){if(e&&e.detail&&e.detail.mediaItems)for(var t=0;t<e.detail.mediaItems.length;t++)switch(e.detail.mediaItems[t].contentType.toLowerCase()){case"document":u(e.detail.mediaItems[t]);break;case"image":d(e.detail.mediaItems[t])}},i=function(){for(var e=n.getAnnotations()||[],t=len=e.length;t--;)/doctype first\. Expected/.test(e[t].text)&&e.splice(t,1);len>e.length&&n.setAnnotations(e)},a=function(){return e.querySelector(".js-editor-ace > textarea")},s=function(){t=ace.edit(a().id),n=t.getSession(),r=e.querySelector(".editor-input"),t.setTheme("ace/theme/monokai"),t.setShowPrintMargin(!1),t.$blockScrolling=1/0,n.setMode("ace/mode/html"),n.setUseWrapMode(!0),n.on("changeAnnotation",i),n.on("change",c),r.addEventListener("change",l),e.addEventListener("editor:valueUpdate",l),e.addEventListener("editor:addMedia",o)},u=function(e){var n=t.selection.getRange().start,r=t.session.getLine(n.row);if('href="'===r.substr(n.column-5,5).toLowerCase())return void t.insert(e.resource);if("href="===r.substr(n.column-4,4).toLowerCase())return void t.insert('"'+e.resource+'"');var o=r.substr(n.column-1,1).toLowerCase();return">"===o||""===o||" "===o?void t.insert('<a href="'+e.resource+'" title="'+e.alternateText+'" class="" />\n'):void t.insert(e.resource)},d=function(e){var n=t.selection.getRange().start,r=t.session.getLine(n.row);if('src="'===r.substr(n.column-5,5).toLowerCase())return void t.insert(e.resource);if("src="===r.substr(n.column-4,4).toLowerCase())return void t.insert('"'+e.resource+'"');if("url("===r.substr(n.column-4,4).toLowerCase())return void t.insert(e.resource);var o=r.substr(n.column-1,1).toLowerCase();return">"===o||""===o||" "===o?void t.insert('<img src="'+e.resource+'" alt="'+e.alternateText+'" class="" />\n'):void t.insert(e.resource)},c=function(){r.value=n.getValue()},l=function(){n.setValue(r.value)};s()},t=function(){for(var t=document.querySelectorAll(".js-editor"),n=0;n<t.length;n++)e(t[n])};document.addEventListener("DOMContentLoaded",t)}(),function(){var e=function(e){var t,n,r,o,i=function(){return document.querySelector(".js-editor-content-type").value},a=function(){var e=document.querySelector("#Title_Title"),t=document.querySelector("#AutoroutePart_CurrentUrl"),n=i(),r="";return e?(r+=t&&t.value?'<a href="/'+t.value+'" target="_blank" title="View current page">'+e.value+"</a>":e.value,n&&"LayoutElement"!==n&&(r+=" ("+n+")"),r||"Unknown"):"HTML Element within Layout"},s=function(e){var t=e.currentTarget.getAttribute("data-action");switch(t){case"open-visual-editor":v();break;case"insert-media":l()}},u=function(){m({action:"destroy"}),window.removeEventListener("message",c),n.style.overflow="",t.style.display="none"},d=function(){t=e.querySelector(".js-editor-medium"),o=e.querySelector(".editor-input"),r=e.querySelector(".js-editor-medium-iframe"),n=document.querySelector("html");for(var i=e.querySelectorAll(".js-toolbar-btn"),a=0;a<i.length;a++)i[a].addEventListener("click",s)},c=function(t){"update"===t.data.action&&(o.value=html_beautify?html_beautify(t.data.value,{wrap_line_length:0}):t.data.value,e.dispatchEvent(new Event("editor:valueUpdate"))),"close"===t.data.action&&u()},l=function(){var t,n=location.href.toLowerCase().indexOf("/admin/");-1!==n&&(t=location.href.substr(0,n)+"/Admin/Orchard.MediaLibrary?dialog=true",$.colorbox({href:t,iframe:!0,reposition:!0,width:"90%",height:"90%",onLoad:function(){$("html, body").css("overflow","hidden")},onClosed:function(){var t=$.colorbox.selectedData;$("html, body").css("overflow",""),0!==t.length&&e.dispatchEvent(new CustomEvent("editor:addMedia",{detail:{mediaItems:t}}))}}))},v=function(){m({action:"initialise",value:o.value,mediaPath:i(),state:a()}),window.addEventListener("message",c),n.style.overflow="hidden",t.style.display=""},m=function(e){r.contentWindow.postMessage(JSON.stringify(e),"*")};d()},t=function(){for(var t=document.querySelectorAll(".js-editor"),n=0;n<t.length;n++)e(t[n])};document.addEventListener("DOMContentLoaded",t)}();