window.Editor=window.Editor||{plugins:[],instances:[]},window.Editor.plugins.push({action:"ace",init:!0,exec:function(e){var t,n,i,o=function(e){if(e&&e.detail&&e.detail.mediaItems)for(var t=0;t<e.detail.mediaItems.length;t++)"document"!==e.detail.mediaItems[t].contentType.toLowerCase()?"image"!==e.detail.mediaItems[t].contentType.toLowerCase()&&"vectorimage"!==e.detail.mediaItems[t].contentType.toLowerCase()||l(e.detail.mediaItems[t]):a(e.detail.mediaItems[t])},r=function(){for(var e=n.getAnnotations()||[],t=len=e.length;t--;)/doctype first\. Expected/.test(e[t].text)&&e.splice(t,1);len>e.length&&n.setAnnotations(e)},s=function(){return e.$el.querySelector(".js-editor-code > textarea")},d=function(){t=ace.edit(s().id),n=t.getSession(),i=e.$el.querySelector(".editor-input"),t.setTheme("ace/theme/monokai"),t.setShowPrintMargin(!1),t.$blockScrolling=1/0,n.setMode("ace/mode/html"),n.setUseWrapMode(!0),n.on("changeAnnotation",r),n.on("change",u),i.addEventListener("change",v),e.$el.addEventListener("editor:valueUpdate",v),e.$el.addEventListener("editor:addMedia",o),e.$el.addEventListener("editor:insertHtml",c)},a=function(e){var n=t.selection.getRange().start,i=t.session.getLine(n.row);if('href="'===i.substr(n.column-5,5).toLowerCase())return void t.insert(e.resource);if("href="===i.substr(n.column-4,4).toLowerCase())return void t.insert('"'+e.resource+'"');var o=i.substr(n.column-1,1).toLowerCase();return">"===o||""===o||" "===o?void t.insert('<a href="'+e.resource+'" title="'+e.alternateText+'" class="" />\n'):void t.insert(e.resource)},l=function(e){var n=t.selection.getRange().start,i=t.session.getLine(n.row);if('src="'===i.substr(n.column-5,5).toLowerCase())return void t.insert(e.resource);if("src="===i.substr(n.column-4,4).toLowerCase())return void t.insert('"'+e.resource+'"');if("url("===i.substr(n.column-4,4).toLowerCase())return void t.insert(e.resource);var o=i.substr(n.column-1,1).toLowerCase();return">"===o||""===o||" "===o?void t.insert('<img src="'+e.resource+'" alt="'+e.alternateText+'" class="" />\n'):void t.insert(e.resource)},c=function(e){e&&e.detail&&e.detail.html&&t.insert(e.detail.html)},u=function(){i.value=n.getValue()},v=function(){n.setValue(i.value)};d()}}),window.Editor.plugins.push({action:"context",init:!0,exec:function(e){var t="is-code-editor",n="is-visual-editor",i=e.$el.querySelector(".js-editor-visual-iframe"),o=function(){return document.querySelector(".js-editor-content-type").value},r=function(){e.$el.classList.remove(n),e.$el.classList.add(t),e.$el.dispatchEvent(new Event("editor:valueUpdate"))},s=function(){var r={action:"update",value:e.$input.value,mediaPath:o(),id:e.id};i.contentWindow.postMessage(JSON.stringify(r),"*"),e.$el.classList.remove(t),e.$el.classList.add(n)};return e.$el.classList.contains(t)?void s():void r()}}),window.Editor.plugins.push({action:"toggle-fullscreen",init:!1,exec:function(e){var t="is-fullscreen",n=27,i=function(o){if(!o||o.keyCode===n){if(e.$el.classList.contains(t))return e.$el.classList.remove(t),document.querySelector("html").style.overflow="",void window.removeEventListener("keydown",i);e.$el.classList.add(t),document.querySelector("html").style.overflow="hidden",window.addEventListener("keydown",i)}};i()}}),window.Editor.plugins.push({action:"insert-embed",init:!1,exec:function(e){var t,n,i,o,r="has-active-dialog",s=e.$el.querySelector(".js-editor-toolbar"),d=document.createElement("div");d.classList.add("editor-dialog"),d.classList.add("js-editor-dialog"),d.innerHTML='<div class="editor-dialog__content"><input type="text" placeholder="Enter URL to YouTube or Vimeo video" class="text large js-embed-url" /><div class="editor-dialog__example js-embed-example"></div><div class="editor-dialog__options"><button type="button" class="js-insert-btn" disabled>Insert</button><button type="button" class="editor-dialog__cancel-btn js-cancel-btn">Cancel</button></div></div>',s.appendChild(d),n=d.querySelector(".js-embed-example"),t=d.querySelector(".js-embed-url"),i=d.querySelector(".js-cancel-btn"),o=d.querySelector(".js-insert-btn");var a=function(e){var t=e.substring(e.lastIndexOf("/")+1);return'<div class="embed">\n	<div class="embed__media">\n		<iframe src="https://player.vimeo.com/video/'+t+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n	</div>\n</div>\n\n'},l=function(e){var t;return t=e.indexOf("youtu.be/")>=0||e.indexOf("youtube.com/embed")>=0?e.substring(e.lastIndexOf("/")+1):e.substring(e.lastIndexOf("v=")+2),'<div class="embed">\n	<div class="embed__media">\n		<iframe src="https://www.youtube.com/embed/'+t+'" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>\n	</div>\n</div>\n\n'},c=function(){d.remove(),e.$el.classList.remove(r)},u=function(){e.$el.dispatchEvent(new CustomEvent("editor:insertHtml",{detail:{html:n.innerHTML}})),c()},v=function(e){var t=e.currentTarget.value,i=t?'<p style="font-size: 0.85em;">Invalid URL (currently only supports Vimeo/YouTube URLs)</p>':"";o.disabled=!0,t.indexOf("vimeo.com")>=0?(i=a(t),o.disabled=!1):(t.indexOf("youtube.com")>=0||t.indexOf(!1))&&(i=l(t),o.disabled=!1),n.innerHTML=i};t.addEventListener("input",v),i.addEventListener("click",c),o.addEventListener("click",u),t.focus(),e.$el.classList.add(r)}}),window.Editor.plugins.push({action:"insert-media",init:!1,exec:function(e){var t=location.href.toLowerCase().indexOf("/admin/"),n=0;-1!==t&&$.colorbox({href:location.href.substr(0,t)+"/Admin/Orchard.MediaLibrary?dialog=true",iframe:!0,reposition:!0,width:"90%",height:"90%",onLoad:function(){n=$("html").scrollTop(),$("html, body").css("overflow","hidden")},onClosed:function(){var t=$.colorbox.selectedData;$("html, body").css("overflow",""),$("html").scrollTop(n),t&&0!==t.length&&e.$el.dispatchEvent(new CustomEvent("editor:addMedia",{detail:{mediaItems:t}}))}})}}),window.Editor.plugins.push({action:"resize",init:!0,exec:function(e){var t,n,i=e.$el.querySelector(".js-editor-resizer"),o=e.$el.querySelector(".js-editor-visual-iframe"),r=function(){window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",r),o.contentWindow.removeEventListener("mousemove",d),o.contentWindow.removeEventListener("mouseup",r)},s=function(i){e.$el.style.height=n+(i.clientY-t)+"px"},d=function(e){var t=o.getBoundingClientRect(),n=new CustomEvent("mousemove",{bubbles:!0,cancelable:!1});n.clientX=e.clientX+t.left,n.clientY=e.clientY+t.top,o.dispatchEvent(n)};i.addEventListener("mousedown",function(i){t=i.clientY,n=e.$el.offsetHeight,window.addEventListener("mousemove",s),window.addEventListener("mouseup",r),o.contentWindow.addEventListener("mousemove",d),o.contentWindow.addEventListener("mouseup",r)})}}),function(){var e=function(e){var t={$el:e,id:e.getAttribute("data-id")},n=function(e){for(var n=e.currentTarget.getAttribute("data-action"),i=window.Editor.plugins,o=0;o<i.length;o++)if(i[o].action===n)return void i[o].exec(t)},i=function(){t.$input=e.querySelector(".editor-input");for(var i=e.querySelectorAll(".js-toolbar-btn"),r=0;r<i.length;r++)i[r].addEventListener("click",n);window.addEventListener("message",o);for(var r=0;r<window.Editor.plugins.length;r++)window.Editor.plugins[r].init&&window.Editor.plugins[r].exec(t)},o=function(n){n.data.id===t.id&&"update"===n.data.action&&(t.$input.value=html_beautify?html_beautify(n.data.value,{wrap_line_length:0}):n.data.value,e.dispatchEvent(new Event("editor:valueUpdate")))};i()},t=function(){for(var t=document.querySelectorAll(".js-editor"),n=0;n<t.length;n++)e(t[n])};document.addEventListener("DOMContentLoaded",t)}();