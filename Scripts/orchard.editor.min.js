!function(){var e=function(e){var t,n,o,r=function(e){if(e&&e.detail&&e.detail.mediaItems)for(var t=0;t<e.detail.mediaItems.length;t++)switch(e.detail.mediaItems[t].contentType.toLowerCase()){case"document":d(e.detail.mediaItems[t]);break;case"image":c(e.detail.mediaItems[t])}},i=function(){for(var e=n.getAnnotations()||[],t=len=e.length;t--;)/doctype first\. Expected/.test(e[t].text)&&e.splice(t,1);len>e.length&&n.setAnnotations(e)},s=function(){return e.querySelector(".js-editor-code > textarea")},a=function(){t=ace.edit(s().id),n=t.getSession(),o=e.querySelector(".editor-input"),t.setTheme("ace/theme/monokai"),t.setShowPrintMargin(!1),t.$blockScrolling=1/0,n.setMode("ace/mode/html"),n.setUseWrapMode(!0),n.on("changeAnnotation",i),n.on("change",u),o.addEventListener("change",l),e.addEventListener("editor:valueUpdate",l),e.addEventListener("editor:addMedia",r)},d=function(e){var n=t.selection.getRange().start,o=t.session.getLine(n.row);if('href="'===o.substr(n.column-5,5).toLowerCase())return void t.insert(e.resource);if("href="===o.substr(n.column-4,4).toLowerCase())return void t.insert('"'+e.resource+'"');var r=o.substr(n.column-1,1).toLowerCase();return">"===r||""===r||" "===r?void t.insert('<a href="'+e.resource+'" title="'+e.alternateText+'" class="" />\n'):void t.insert(e.resource)},c=function(e){var n=t.selection.getRange().start,o=t.session.getLine(n.row);if('src="'===o.substr(n.column-5,5).toLowerCase())return void t.insert(e.resource);if("src="===o.substr(n.column-4,4).toLowerCase())return void t.insert('"'+e.resource+'"');if("url("===o.substr(n.column-4,4).toLowerCase())return void t.insert(e.resource);var r=o.substr(n.column-1,1).toLowerCase();return">"===r||""===r||" "===r?void t.insert('<img src="'+e.resource+'" alt="'+e.alternateText+'" class="" />\n'):void t.insert(e.resource)},u=function(){o.value=n.getValue()},l=function(){n.setValue(o.value)};a()},t=function(){for(var t=document.querySelectorAll(".js-editor"),n=0;n<t.length;n++)e(t[n])};document.addEventListener("DOMContentLoaded",t)}(),function(){var e="is-code-editor",t="is-visual-editor",n="is-fullscreen",o=27,r=function(r){var i,s,a,d,c=function(){return document.querySelector(".js-editor-content-type").value},u=function(e){var t=e.currentTarget.getAttribute("data-action");switch(t){case"insert-media":m();break;case"toggle-code-editor":w();break;case"toggle-visual-editor":g();break;case"toggle-fullscreen":h()}},l=function(){i=r.querySelector(".js-editor-visual"),a=r.querySelector(".editor-input"),s=r.querySelector(".js-editor-visual-iframe"),d=r.querySelector(".js-editor-resizer");for(var e=r.querySelectorAll(".js-toolbar-btn"),t=0;t<e.length;t++)e[t].addEventListener("click",u);window.addEventListener("message",v),w(),f()},v=function(e){"update"===e.data.action&&(a.value=html_beautify?html_beautify(e.data.value,{wrap_line_length:0}):e.data.value,r.dispatchEvent(new Event("editor:valueUpdate")))},m=function(){var e,t=location.href.toLowerCase().indexOf("/admin/");-1!==t&&(e=location.href.substr(0,t)+"/Admin/Orchard.MediaLibrary?dialog=true",$.colorbox({href:e,iframe:!0,reposition:!0,width:"90%",height:"90%",onLoad:function(){$("html, body").css("overflow","hidden")},onClosed:function(){var e=$.colorbox.selectedData;$("html, body").css("overflow",""),0!==e.length&&r.dispatchEvent(new CustomEvent("editor:addMedia",{detail:{mediaItems:e}}))}}))},f=function(){var e,t,n=function(){window.removeEventListener("mousemove",o),window.removeEventListener("mouseup",n),s.contentWindow.removeEventListener("mousemove",i),s.contentWindow.removeEventListener("mouseup",n)},o=function(n){r.style.height=t+(n.clientY-e)+"px"},i=function(e){var t=s.getBoundingClientRect(),n=new CustomEvent("mousemove",{bubbles:!0,cancelable:!1});n.clientX=e.clientX+t.left,n.clientY=e.clientY+t.top,s.dispatchEvent(n)};d.addEventListener("mousedown",function(a){e=a.clientY,t=r.offsetHeight,window.addEventListener("mousemove",o),window.addEventListener("mouseup",n),s.contentWindow.addEventListener("mousemove",i),s.contentWindow.addEventListener("mouseup",n)})},w=function(){r.classList.remove(t),r.classList.add(e),r.dispatchEvent(new Event("editor:valueUpdate"))},h=function(e){if(!e||e.keyCode===o){if(r.classList.contains(n))return r.classList.remove(n),document.querySelector("html").style.overflow="",void window.removeEventListener("keydown",h);r.classList.add(n),document.querySelector("html").style.overflow="hidden",window.addEventListener("keydown",h)}},g=function(){L({action:"update",value:a.value,mediaPath:c()}),r.classList.remove(e),r.classList.add(t)},L=function(e){s.contentWindow.postMessage(JSON.stringify(e),"*")};l()},i=function(){for(var e=document.querySelectorAll(".js-editor"),t=0;t<e.length;t++)r(e[t])};document.addEventListener("DOMContentLoaded",i)}();